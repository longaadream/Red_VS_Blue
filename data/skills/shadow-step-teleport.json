{
  "id": "shadow-step-teleport",
  "name": "æš—å½±æ­¥ä¼ é€",
  "description": "å›åˆå¼€å§‹æ—¶ä¼ é€åˆ°é¢„è®¾ä½ç½®",
  "icon": "ğŸ‘¤",
  "kind": "passive",
  "type": "normal",
  "cooldownTurns": 0,
  "maxCharges": 0,
  "powerMultiplier": 1,
  "actionPointCost": 0,
  "range": "self",
  "requiresTarget": false,
  "code": "function executeSkill(context) { console.log('[ShadowStep] Executing shadow-step-teleport skill'); const sourcePiece = context.piece; console.log('[ShadowStep] sourcePiece:', sourcePiece ? sourcePiece.instanceId : 'null'); if (!sourcePiece.statusTags) { console.log('[ShadowStep] No statusTags, returning'); return { message: '', success: true }; } console.log('[ShadowStep] statusTags:', sourcePiece.statusTags.map(t => ({ type: t.type, remainingDuration: t.remainingDuration }))); const shadowStepStatus = sourcePiece.statusTags.find(tag => tag.type === 'shadow-step'); console.log('[ShadowStep] shadowStepStatus:', shadowStepStatus); if (!shadowStepStatus) { console.log('[ShadowStep] No shadow-step status found, returning'); return { message: '', success: true }; } if (shadowStepStatus.remainingDuration <= 0) { console.log('[ShadowStep] remainingDuration <= 0, returning'); return { message: '', success: true }; } const targetX = shadowStepStatus.value; const targetY = shadowStepStatus.intensity; console.log('[ShadowStep] Target position:', targetX, targetY); const targetTile = battle.map.tiles.find(t => t.x === targetX && t.y === targetY); const pieceAtPos = battle.pieces.find(p => p.x === targetX && p.y === targetY && p.currentHp > 0); if (pieceAtPos) { console.log('[ShadowStep] Target position occupied by', pieceAtPos.instanceId); targetTile.props.walkable = true; targetTile.props.shadowStepTarget = false; const index = sourcePiece.statusTags.findIndex(tag => tag.type === 'shadow-step'); if (index !== -1) { sourcePiece.statusTags.splice(index, 1); } return { message: sourcePiece.name + 'çš„æš—å½±æ­¥ç›®æ ‡ä½ç½®å·²è¢«å ç”¨', success: true }; } if (!targetTile) { console.log('[ShadowStep] Target tile not found'); const index = sourcePiece.statusTags.findIndex(tag => tag.type === 'shadow-step'); if (index !== -1) { sourcePiece.statusTags.splice(index, 1); } return { message: sourcePiece.name + 'çš„æš—å½±æ­¥ç›®æ ‡ä½ç½®å·²ä¸å­˜åœ¨', success: true }; } console.log('[ShadowStep] Teleporting to', targetX, targetY); targetTile.props.walkable = true; targetTile.props.shadowStepTarget = false; sourcePiece.x = targetX; sourcePiece.y = targetY; shadowStepStatus.remainingDuration = 0; const index = sourcePiece.statusTags.findIndex(tag => tag.type === 'shadow-step'); if (index !== -1) { sourcePiece.statusTags.splice(index, 1); } console.log('[ShadowStep] Teleport successful'); return { message: sourcePiece.name + 'é€šè¿‡æš—å½±æ­¥ä¼ é€åˆ°äº†(' + targetX + ',' + targetY + ')', success: true }; }"
}
